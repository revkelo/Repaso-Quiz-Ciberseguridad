<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz — Seguridad de la Información (Parcial 1 y 2)</title>
  <script>
    // Desactiva preflight si decides añadir Tailwind más tarde desde CDN
    window.tailwind = { config: { corePlugins: { preflight: false } } };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    .glass { background: rgba(17,24,39,.7); backdrop-filter: blur(8px); }
    .choice:hover { transform: translateY(-1px); }
    .shake { animation: shake .25s ease-in-out 0s 2; }
    @keyframes shake { 0%{transform: translateX(0)} 25%{transform: translateX(-2px)} 50%{transform: translateX(2px)} 75%{transform: translateX(-2px)} 100%{transform: translateX(0)} }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-900 via-slate-900 to-slate-800 text-slate-100">
  <div class="max-w-5xl mx-auto p-4 sm:p-6">
    <header class="flex items-center justify-between gap-4 mb-6">
      <h1 class="text-2xl sm:text-3xl font-bold tracking-tight">Quiz — Seguridad de la Información</h1>
      <button id="btnReset" class="hidden px-3 py-2 rounded-xl bg-slate-800/70 hover:bg-slate-700 transition">Reiniciar</button>
    </header>

    <!-- Panel de configuración -->
    <section id="setup" class="glass rounded-2xl p-5 sm:p-6 shadow-xl">
      <div class="grid sm:grid-cols-3 gap-4">
        <div class="col-span-3 sm:col-span-1">
          <label class="block text-sm mb-1">Banco de preguntas</label>
          <select id="bank" class="w-full bg-slate-800/70 border border-slate-700 rounded-xl px-3 py-2">
            <option value="ambos">Parcial 1 + Parcial 2</option>
            <option value="p1">Solo Parcial 1</option>
            <option value="p2">Solo Parcial 2</option>
          </select>
        </div>
        <div>
          <label class="block text-sm mb-1">Número de preguntas</label>
          <select id="count" class="w-full bg-slate-800/70 border border-slate-700 rounded-xl px-3 py-2">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="all">Todas</option>
          </select>
        </div>
        <div>
          <label class="block text-sm mb-1">Opciones</label>
          <div class="flex gap-3 items-center">
            <label class="inline-flex items-center gap-2"><input id="shuffle" type="checkbox" class="accent-sky-400"> <span>Barajar</span></label>
            <label class="inline-flex items-center gap-2"><input id="instant" type="checkbox" class="accent-sky-400"> <span>Corrección inmediata</span></label>
          </div>
        </div>
      </div>

      <div class="mt-5 flex flex-wrap gap-3 items-center">
        <button id="btnStart" class="px-4 py-2 rounded-2xl bg-sky-600 hover:bg-sky-500 font-semibold">Comenzar</button>
        <button id="btnShowAll" class="px-4 py-2 rounded-2xl bg-slate-800/70 hover:bg-slate-700">Vista de estudio</button>
      </div>
    </section>

    <!-- Vista de estudio -->
    <section id="study" class="hidden mt-6 glass rounded-2xl p-5 sm:p-6">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold">Vista de estudio (todas las preguntas filtradas)</h2>
        <button class="px-3 py-2 rounded-xl bg-slate-800/70 hover:bg-slate-700" onclick="closeStudy()">Cerrar</button>
      </div>
      <div id="studyList" class="space-y-6"></div>
    </section>

    <!-- Contenedor del quiz -->
    <section id="quiz" class="hidden mt-6">
      <div class="glass rounded-2xl p-5 sm:p-6 shadow-xl">
        <div class="flex items-center justify-between mb-4">
          <div class="text-sm opacity-80" id="progress">Pregunta 1 / N</div>
          <div class="text-sm opacity-80" id="meta"></div>
        </div>

        <h2 id="qtext" class="text-lg sm:text-xl font-semibold mb-4"></h2>
        <div id="multiHint" class="text-xs text-sky-300 mb-3 hidden">Esta pregunta admite varias respuestas. Selecciona todas las que apliquen.</div>
        <div id="choices" class="grid gap-3"></div>

        <div class="mt-5 flex flex-wrap items-center gap-3">
          <button id="btnPrev" class="px-4 py-2 rounded-2xl bg-slate-800/70 hover:bg-slate-700">Anterior</button>
          <button id="btnNext" class="px-4 py-2 rounded-2xl bg-sky-600 hover:bg-sky-500 font-semibold">Siguiente</button>
          <button id="btnCheck" class="px-4 py-2 rounded-2xl bg-emerald-600 hover:bg-emerald-500 font-semibold">Comprobar</button>
          <button id="btnFlag" class="px-3 py-2 rounded-xl bg-yellow-600/30 hover:bg-yellow-600/40">Marcar</button>
          <div class="ml-auto text-sm opacity-80" id="counter"></div>
        </div>
      </div>

      <div id="navGrid" class="mt-4 grid grid-cols-10 sm:grid-cols-12 gap-2"></div>

      <div id="results" class="hidden mt-6 glass rounded-2xl p-5 sm:p-6">
        <h3 class="text-xl font-bold mb-2">Resultados</h3>
        <p id="score"></p>
        <div class="mt-4 flex flex-wrap gap-3">
          <button onclick="review()" class="px-4 py-2 rounded-2xl bg-slate-800/70 hover:bg-slate-700">Revisar respuestas</button>
          <button id="btnRestart" class="px-4 py-2 rounded-2xl bg-sky-600 hover:bg-sky-500 font-semibold">Volver a empezar</button>
        </div>
      </div>
    </section>

    <footer class="mt-10 text-xs opacity-60 text-center">Hecho con ❤️ para practicar Parciales 1 y 2. Soporta respuestas múltiples y aleatorización.</footer>
  </div>

  <script>
    // ===============================
    // Datos de preguntas (Parcial 1 y 2)
    // ===============================
    const RAW = [
      // -------- PARCIAL 1 --------
      { id: 'P1-01', parcial: 'p1', text: '¿Cómo nos podemos defender contra los ataques de fuerza bruta a las contraseñas?', subtitle: '(Escoge todas las correctas)', options: [
        ['A','Incorporar sales en el hash de contraseñas'],
        ['B','Imponer el uso de contraseñas seguras'],
        ['C','Almacenar contraseñas en una tabla de arco iris'],
        ['D','Pasar las contraseñas por la función de hash varias veces (key stretching)'],
      ], correct: ['A','B','D'] },
      { id: 'P1-02', parcial: 'p1', text: '¿Cuántas tácticas tiene la matriz MITRE ATT&CK?', options: [
        ['A','25'],['B','+250'],['C','5'],['D','14']
      ], correct: ['D'] },
      { id: 'P1-03', parcial: 'p1', text: 'La táctica del RECONOCIMIENTO consiste en:', options: [
        ['A','Emplear tácticas para evitar ser detectado por los controles de seguridad'],
        ['B','Adquirir nombres de cuentas, contraseñas e info de autenticación alternativa'],
        ['C','Navegar dentro del entorno de destino para acceder a recursos adicionales'],
        ['D','Garantizar el acceso continuo al sistema comprometido y mantener un punto de apoyo'],
        ['E','Obtener el acceso inicial a una red de destino'],
        ['F','Extracción de datos confidenciales del entorno de destino para uso no autorizado'],
        ['G','Recopilación de información para planificar y diseñar estrategias para operaciones futuras'],
      ], correct: ['G'] },
      { id: 'P1-04', parcial: 'p1', text: '¿Qué ocurre si un virus informático infecta el e-commerce y modifica los precios en su sitio web?', options: [
        ['A','Se compromete la confidencialidad de los datos'],
        ['B','Se interrumpe la disponibilidad de la información'],
        ['C','Se viola la integridad de los registros'],
        ['D','(Opción de autenticidad/no aplica)'],
      ], correct: ['C'] },
      { id: 'P1-05', parcial: 'p1', text: '¿Cuál de las siguientes afirmaciones describe mejor la utilización de la criptografía asimétrica?', options: [
        ['A','Utiliza la misma clave para cifrar y descifrar (simétrica)'],
        ['B','Se usa clave privada para cifrar y pública para descifrar (enunciado impreciso)'],
        ['C','Cada usuario tiene un par de claves (pública y privada) para cifrar/descifrar de forma segura'],
        ['D','Utiliza una clave compartida entre emisor y receptor (simétrica)'],
      ], correct: ['C'] },
      { id: 'P1-06', parcial: 'p1', text: 'La ISO 27001 es un estándar certificable', options: [
        ['A','Verdadero'],['B','Falso']
      ], correct: ['A'] },
      { id: 'P1-07', parcial: 'p1', text: 'Cuanto más pequeña sea la clave de encriptación, más seguros estarán los datos cifrados', options: [
        ['A','Verdadero'],['B','Falso']
      ], correct: ['B'] },
      { id: 'P1-08', parcial: 'p1', text: '¿Cuáles son los principales servicios ofrecidos por las infraestructuras de clave pública (PKI)?', subtitle:'(Elige todas las correctas)', options: [
        ['A','Generación de tokens de autenticación'],
        ['B','Emisión y gestión de certificados digitales'],
        ['C','Gestión de claves públicas y privadas'],
        ['D','Validación de la identidad de usuarios y dispositivos'],
        ['E','Implementación de políticas de seguridad de red'],
      ], correct: ['B','C','D'] },
      { id: 'P1-09', parcial: 'p1', text: '¿Qué es una colisión de hash?', options: [
        ['A','Dos archivos idénticos generan diferentes resúmenes de hash'],
        ['B','Dos algoritmos de hash diferentes producen el mismo hash'],
        ['C','Dos archivos diferentes generan el mismo resumen de hash'],
        ['D','Un resumen de hash se invierte para recuperar el original'],
      ], correct: ['C'] },
      { id: 'P1-10', parcial: 'p1', text: '¿Cuál describe mejor el cifrado Vernam?', options: [
        ['A','Clave secreta compartida para cifrar/descifrar'],
        ['B','Clave pública para cifrar y privada para descifrar'],
        ['C','La misma clave para cifrar y descifrar (simétrica)'],
        ['D','Cifrado de flujo que combina el texto con una clave de igual longitud'],
      ], correct: ['D'] },
      { id: 'P1-11', parcial: 'p1', text: 'En un certificado SSL, la clave pública del servidor está firmada por una CA, garantizando la autenticidad del servidor.', options: [["A","Verdadero"],["B","Falso"]], correct: ['A'] },
      { id: 'P1-12', parcial: 'p1', text: 'Acceso indebido a BD sensible por parte de empleado implica…', options: [
        ['A','Se compromete la integridad de la información'],
        ['B','Se viola la confidencialidad de los datos'],
        ['C','Se interrumpe la disponibilidad de la base de datos'],
        ['D','Se compromete la autenticidad de los registros'],
      ], correct: ['B'] },
      { id: 'P1-13', parcial: 'p1', text: 'Medidas para proteger el login de una plataforma web', subtitle:'(Seleccione todas)', options: [
        ['A','Hash seguro de contraseñas en BD'],
        ['B','MFA'],
        ['C','Contraseñas en texto plano'],
        ['D','Permitir contraseñas simples'],
        ['E','Certificado SSL durante el login'],
      ], correct: ['A','B','E'] },
      { id: 'P1-14', parcial: 'p1', text: 'Últimas dos versiones de ISO 27001', options: [
        ['A','Solo existe la 2022'],['B','2023 y 2013'],['C','2022 y 2014'],['D','2022 y 2025'],['E','2022 y 2013'],['F','2012 y 2013'],['G','2022 y 2012'],
      ], correct: ['E'] },
      { id: 'P1-15', parcial: 'p1', text: '¿Cuál NO pertenece a un buen algoritmo de hash?', options: [
        ['A','El mismo mensaje siempre produce el mismo hash'],
        ['B','Colisión de hash'],
        ['C','Determinismo'],
        ['D','No es reversible'],
      ], correct: ['B'] },
      { id: 'P1-16', parcial: 'p1', text: 'Primera subfase en auditoría de seguridad', options: [
        ['A','Post Explotación'],['B','Explotación'],['C','Fingerprinting'],['D','Footprinting']
      ], correct: ['D'] },
      { id: 'P1-17', parcial: 'p1', text: 'Caso apropiado para aplicar hash', options: [
        ['A','Garantizar disponibilidad'],['B','Almacenar contraseñas en una base de datos'],['C','Cifrar comunicación'],['D','Garantizar confidencialidad']
      ], correct: ['B'] },
      { id: 'P1-18', parcial: 'p1', text: 'Herramientas para fuerza bruta/diccionario vistas en clase', options: [
        ['A','John y CCrypt'],['B','John y HashRat'],['C','John y HashCat'],['D','HashRat y HashCat']
      ], correct: ['C'] },
      { id: 'P1-19', parcial: 'p1', text: 'Características del cifrado Polibio', subtitle:'(marque todas las válidas)', options: [
        ['A','Utiliza una tabla de sustitución para cifrar mensajes'],
        ['B','Es un cifrado de sustitución monoalfabético'],
        ['C','Convierte cada letra en un par de números'],
        ['D','Requiere clave secreta'],
        ['E','Es de transposición'],
      ], correct: ['A','B','C'] },
      { id: 'P1-20', parcial: 'p1', text: 'Componentes clave de una PKI', subtitle:'(marque todas las válidas)', options: [
        ['A','Autoridad de Certificación (CA)'],['B','Certificado de Antecedentes Penales (CAP)'],['C','Centro de Datos'],['D','Almacén de Claves (Key Store / HSM)'],['E','Servidor SMTP']
      ], correct: ['A','D'] },
      { id: 'P1-21', parcial: 'p1', text: 'En auditoría de seguridad, pensar con perspectiva ________.', options: [
        ['A','Atacante'],['B','Ofensiva'],['C','Hacker'],['D','Defensiva']
      ], correct: ['A'] },
      { id: 'P1-22', parcial: 'p1', text: 'Mejor descripción de seguridad de la información', options: [
        ['A','Responsabilidad exclusiva de TI'],
        ['B','Solo prevenir ataques externos'],
        ['C','Proceso integral que protege confidencialidad, integridad y disponibilidad'],
        ['D','Solo protección física'],
      ], correct: ['C'] },
      { id: 'P1-23', parcial: 'p1', text: 'Tipo de validación SSL con chequeo exhaustivo y barra verde (histórica)', options: [
        ['A','Validación extendida'],['B','Validación organizativa'],['C','Validación de dominio'],['D','Nivel básico']
      ], correct: ['A'] },
      { id: 'P1-24', parcial: 'p1', text: 'Movimiento lateral consiste en…', options: [
        ['A','Adquirir credenciales'],['B','Entender el entorno'],['C','Navegar para acceder a recursos adicionales'],['D','Planear estrategias futuras'],['E','Manipular/destruir objetivos'],['F','Preparar recursos'],['G','Evadir defensas']
      ], correct: ['C'] },
      { id: 'P1-25', parcial: 'p1', text: 'Exfiltración consiste en…', options: [
        ['A','Entender el entorno'],['B','Extracción de datos confidenciales para uso no autorizado'],['C','Recopilar datos para objetivos del atacante'],['D','Movimiento lateral'],['E','C2 remoto'],
      ], correct: ['B'] },
      { id: 'P1-26', parcial: 'p1', text: 'ISO 27001:2022 anexo A separa controles en ___ grupos.', options: [
        ['A','5'],['B','4'],['C','3'],['D','6']
      ], correct: ['B'] },
      { id: 'P1-27', parcial: 'p1', text: 'En un certificado SSL, la clave pública del servidor está firmada por una CA…', options: [["A","Verdadero"],["B","Falso"]], correct: ['A'] },
      { id: 'P1-28', parcial: 'p1', text: 'Firma electrónica con máximas garantías legales', options: [
        ['A','Firma electrónica simple'],['B','Firma digital'],['C','Firma manuscrita'],['D','Firma electrónica avanzada']
      ], correct: ['D'] },
      { id: 'P1-29', parcial: 'p1', text: 'Algoritmo eficiente para grandes volúmenes con una sola clave', options: [
        ['A','ECDSA'],['B','RSA'],['C','Diffie-Hellman'],['D','AES']
      ], correct: ['D'] },
      { id: 'P1-30', parcial: 'p1', text: 'En un certificado SSL, la clave pública del servidor está firmada…', options: [["A","Verdadero"],["B","Falso"]], correct: ['A'] },

      // -------- PARCIAL 2 --------
      { id: 'P2-01', parcial: 'p2', text: 'La táctica de la EXFILTRACIÓN consiste en…', options: [
        ['A','Movimiento lateral'],['B','Evadir defensas'],['C','Recopilar datos relevantes'],['D','Entender el entorno'],['E','Extracción de datos confidenciales'],['G','C2 remoto']
      ], correct: ['E'] },
      { id: 'P2-02', parcial: 'p2', text: 'La táctica del RECONOCIMIENTO consiste en…', options: [
        ['A','Recopilar información para planear futuras operaciones'],['B','Mantener punto de apoyo'],['C','Acceso inicial'],['D','Adquirir credenciales'],['E','Movimiento lateral'],['F','Exfiltración'],['G','Evadir defensas']
      ], correct: ['A'] },
      { id: 'P2-03', parcial: 'p2', text: '¿Cuál describe mejor el cifrado Vernam?', options: [
        ['A','Clave pública/privada'],['B','Flujo + clave de igual longitud'],['C','Misma clave para cifrar/descifrar'],['D','Clave secreta compartida']
      ], correct: ['B'] },
      { id: 'P2-04', parcial: 'p2', text: 'Primera subfase de investigación en auditoría', options: [
        ['A','Footprinting'],['B','Post Explotación'],['C','Fingerprinting'],['D','Explotación']
      ], correct: ['A'] },
      { id: 'P2-05', parcial: 'p2', text: 'Los “pawns” son conscientes de que ayudan al atacante.', options: [["A","Verdadero"],["B","Falso"]], correct: ['B'] },
      { id: 'P2-06', parcial: 'p2', text: 'Tipo de validación SSL con verificación exhaustiva', options: [
        ['A','Nivel básico'],['B','Validación organizativa'],['C','Validación de dominio'],['D','Validación extendida']
      ], correct: ['D'] },
      { id: 'P2-07', parcial: 'p2', text: 'ISO 27001:2022 — anexo A en ___ grupos', options: [["A","6"],["B","4"],["C","5"],["D","3"]], correct: ['B'] },
      { id: 'P2-08', parcial: 'p2', text: '¿Por qué el Preprocesamiento es crucial en biometría?', options: [
        ['A','Genera claves criptográficas'],['B','Cifra plantillas'],['C','Autenticación previa al registro'],['D','Mejora calidad y reduce ruido']
      ], correct: ['D'] },
      { id: 'P2-09', parcial: 'p2', text: 'La fijación de sesión ocurre cuando…', options: [["A","Verdadero"],["B","Falso"]], correct: ['A'] },
      { id: 'P2-10', parcial: 'p2', text: 'Malware que cifra archivos y exige pago', options: [
        ['A','Spyware'],['B','Ransomware'],['C','Troyano'],['D','Adware']
      ], correct: ['B'] },
      { id: 'P2-11', parcial: 'p2', text: 'Orden correcto de fases APT', subtitle:'(b,a,d,c,f,e,g)', options: [
        ['A','b,a,d,c,f,e,g'],['B','b,d,a,c,f,e,g'],['C','b,a,f,d,e,c,g'],['D','b,a,d,c,e,f,g']
      ], correct: ['A'] },
      { id: 'P2-12', parcial: 'p2', text: 'Sobre “información crítica” (seleccione todas)', options: [
        ['A','Su pérdida no afecta continuidad'],['B','Su pérdida puede interrumpir operaciones'],['C','Es fundamental para objetivos y actividades'],['D','Es secundaria']
      ], correct: ['B','C'] },
      { id: 'P2-13', parcial: 'p2', text: 'Firma electrónica con máximas garantías', options: [
        ['A','Firma electrónica avanzada'],['B','Firma digital'],['C','Firma electrónica simple'],['D','Firma manuscrita']
      ], correct: ['A'] },
      { id: 'P2-14', parcial: 'p2', text: 'ISO 27001 es certificable', options: [["A","Verdadero"],["B","Falso"]], correct: ['A'] },
      { id: 'P2-15', parcial: 'p2', text: 'Amenazas se clasifican en…', options: [
        ['A','Internas y Externas'],['B','Info / Lógica'],['C','Software / Hardware'],['D','Físicas / Aplicaciones']
      ], correct: ['A'] },
      { id: 'P2-16', parcial: 'p2', text: 'CVE es una lista de identificadores únicos de vulnerabilidades', options: [["A","Verdadero"],["B","Falso"]], correct: ['A'] },
      { id: 'P2-17', parcial: 'p2', text: 'Seguridad de la información en una organización', options: [
        ['A','Solo protección física'],['B','Proceso integral que protege CID'],['C','Exclusivo de TI'],['D','Solo ataques externos']
      ], correct: ['B'] },
      { id: 'P2-18', parcial: 'p2', text: 'MITRE técnica asociada a robar credenciales en memoria', options: [
        ['A','Keylogging'],['B','Explotar kernel'],['C','Credential Dumping'],['D','Pass-the-Hash']
      ], correct: ['C'] },
      { id: 'P2-19', parcial: 'p2', text: '¿Cuántas tácticas tiene MITRE ATT&CK?', options: [["A","+250"],["B","25"],["C","14"],["D","5"]], correct: ['C'] },
      { id: 'P2-20', parcial: 'p2', text: 'Características del cifrado de Polibio (seleccione todas)', options: [
        ['A','Requiere clave secreta'],['B','Tabla de sustitución'],['C','Par de números por letra'],['D','Transposición'],['E','Sustitución monoalfabética']
      ], correct: ['B','C','E'] },
      { id: 'P2-21', parcial: 'p2', text: '¿Cuál NO pertenece a un buen hash?', options: [["A","No es reversible"],["B","Mismo mensaje = mismo hash"],["C","Colisión de hash"],["D","Determinismo"]], correct: ['C'] },
      { id: 'P2-22', parcial: 'p2', text: 'Google Dorking es…', options: [
        ['A','Programa de Google de IA'],['B','Phishing que usa Google'],['C','Búsqueda avanzada con operadores para info sensible/no indexada'],['D','Búsquedas en Google Drive']
      ], correct: ['C'] },
      { id: 'P2-23', parcial: 'p2', text: 'Operación hábil, discreta y prolongada dirigida a objetivo específico', options: [["A","Vulnerabilidad"],["B","CVE"],["C","Amenaza"],["D","APT"]], correct: ['D'] },
      { id: 'P2-24', parcial: 'p2', text: 'En un certificado SSL la CA firma la clave pública del servidor…', options: [["A","Verdadero"],["B","Falso"]], correct: ['A'] },
      { id: 'P2-25', parcial: 'p2', text: 'Vida / multimodal / cripto biométrica — afirmación correcta', options: [
        ['A','Liveness activa pide acciones; pasiva detecta rasgos (reflejos, microexpresiones)'],
        ['B','Algoritmos homomórficos no permiten procesar sin descifrar'],
        ['C','Multimodal exige misma plantilla'],
        ['D','Protección con cifrado homomórfico “no se usa”'],
      ], correct: ['A'] },
      { id: 'P2-26', parcial: 'p2', text: 'Empareje conceptos: Botnet, Vector de ataque, DDoS, Backdoor (orden 1→4)', options: [
        ['A','D, B, A, C'],['B','B, A, C, D'],['C','A, B, D, C'],['D','D, A, C, B']
      ], correct: ['A'] },
      { id: 'P2-27', parcial: 'p2', text: 'Herramientas para fuerza bruta vistas en clase', options: [
        ['A','John y HashRat'],['B','John y HashCat'],['C','John y CCrypt'],['D','HashRat y HashCat']
      ], correct: ['B'] },
      { id: 'P2-28', parcial: 'p2', text: 'En un certificado SSL la CA firma la clave pública del servidor…', options: [["A","Verdadero"],["B","Falso"]], correct: ['A'] },
      { id: 'P2-29', parcial: 'p2', text: 'En auditoría, pensar con perspectiva ________.', options: [["A","Atacante"],["B","Ofensiva"],["C","Hacker"],["D","Defensiva"]], correct: ['A'] },
      { id: 'P2-30', parcial: 'p2', text: 'Sobre vulnerabilidades (elige todas)', options: [
        ['A','Se resuelven una vez descubiertas'],['B','Ponen en riesgo CID'],['C','Se producen por alta protección']
      ], correct: ['A','B'] },
      { id: 'P2-31', parcial: 'p2', text: 'Clave más pequeña = ¿más segura?', options: [["A","Verdadero"],["B","Falso"]], correct: ['B'] },
      { id: 'P2-32', parcial: 'p2', text: 'MITRE — malware que altera el MBR para bloquear acceso', options: [
        ['A','Initial Access'],['B','Impact'],['C','Exfiltration'],['D','Privilege Escalation']
      ], correct: ['B'] },
      { id: 'P2-33', parcial: 'p2', text: 'Orden correcto APT (E D A F G B C)', options: [
        ['A','EDAFGBC'],['B','EDAFGCB'],['C','DAFGEBC'],['D','ADEBCFG']
      ], correct: ['A'] },
      { id: 'P2-34', parcial: 'p2', text: 'Últimas dos versiones de ISO 27001', options: [
        ['A','2012 y 2013'],['B','2022 y 2013'],['C','2022 y 2014'],['D','Solo 2022'],['E','2023 y 2013'],['F','2022 y 2025'],['G','2022 y 2012']
      ], correct: ['B'] },
      { id: 'P2-35', parcial: 'p2', text: '¿Qué FW filtra por puertos y estado de conexión?', options: [
        ['A','FW Red'],['B','FW host'],['C','FW Aplicación'],['D','FW Puertos']
      ], correct: ['A'] },
      { id: 'P2-36', parcial: 'p2', text: 'Elementos clave de seguridad lógica', options: [
        ['A','Anti-malware, RRHH, controles de acceso y seguridad física'],
        ['B','Seguridad física, anti-malware, RRHH, biométrica'],
        ['C','CID'],
        ['D','Controles de acceso, seguridad física, anti-malware'],
      ], correct: ['A'] },
      { id: 'P2-37', parcial: 'p2', text: 'Sobre vulnerabilidades (elige todas)', options: [
        ['A','Se producen por alta protección'],['B','Pueden resolverse al descubrirse'],['C','Nunca comprometen integridad'],['D','Ponen en riesgo CID']
      ], correct: ['B','D'] },
      { id: 'P2-38', parcial: 'p2', text: 'Medidas para proteger login (elige todas)', options: [
        ['A','MFA'],['B','Permitir contraseñas simples'],['C','Guardar contraseñas en texto plano'],['D','SSL/TLS en el navegador'],['E','Hash seguro en BD']
      ], correct: ['A','D','E'] },
      { id: 'P2-39', parcial: 'p2', text: 'Tecnología para prevenir spyware/adware', options: [
        ['A','antispyware'],['B','Antivirus Red'],['C','Firewall'],['D','WAF']
      ], correct: ['A'] },
      { id: 'P2-40', parcial: 'p2', text: 'Tipo de XSS que no persiste en servidor (se ejecuta al visitar)', options: [
        ['A','XSS persistente'],['B','XSS basado en DOM'],['C','Inyección SQL'],['D','XSS reflejado']
      ], correct: ['D'] },
      { id: 'P2-41', parcial: 'p2', text: 'La táctica del MOVIMIENTO LATERAL consiste en…', options: [
        ['A','Acceder a recursos adicionales'],['B','Evadir defensas'],['C','Impactar sistemas'],['D','Preparar recursos']
      ], correct: ['A'] },
      { id: 'P2-42', parcial: 'p2', text: 'Usuario que puede iniciar sesión por Telnet con contraseña en blanco', options: [["A","root"],["B","sysadmin"],["C","superadmin"],["D","admin"]], correct: ['A'] },
      { id: 'P2-43', parcial: 'p2', text: 'ISO 27001:2022 — protección de activos físicos (seleccione todas)', options: [
        ['A','Firewalls y antivirus'],['B','Monitoreo de redes internas'],['C','Servidores resguardados y control de accesos'],['D','Restringir uso de USB en estaciones']
      ], correct: ['C','D'] },
      { id: 'P2-44', parcial: 'p2', text: 'Componentes clave de una PKI (seleccione todas)', options: [
        ['A','Autoridad de Certificación (CA)'],['B','Centro de Datos'],['C','Almacén de Claves (Key Store / HSM)'],['D','SMTP'],['E','CAP']
      ], correct: ['A','C'] },
      { id: 'P2-45', parcial: 'p2', text: 'Acceso indebido a BD sensible implica…', options: [
        ['A','Integridad'],['B','Confidencialidad'],['C','Disponibilidad'],['D','Autenticidad']
      ], correct: ['B'] },
      { id: 'P2-46', parcial: 'p2', text: 'El spyware no afecta rendimiento porque es invisible.', options: [["A","Verdadero"],["B","Falso"]], correct: ['B'] },
      { id: 'P2-47', parcial: 'p2', text: 'Principales servicios PKI (seleccione todas)', options: [
        ['A','Emisión y gestión de certificados'],['B','Validación de identidad'],['C','Generación de tokens'],['D','Políticas de seguridad de red'],['E','Gestión de claves públicas y privadas']
      ], correct: ['A','B','E'] },
      { id: 'P2-48', parcial: 'p2', text: '¿Qué distingue esteganografía de criptografía?', options: [
        ['A','Cripto transforma; estego oculta en un medio'],['B','Estego solo en imágenes'],['C','Estego cifra'],['D','Cripto no altera estructura']
      ], correct: ['A'] },
      { id: 'P2-49', parcial: 'p2', text: '¿Qué es seguridad informática? (seleccione las correctas)', options: [
        ['A','Proteger info de sistemas para mitigar amenazas, riesgos y ataques'],
        ['B','Proteger confidencialidad de info, sistemas y redes de amenazas/riesgos/ataques'],
        ['C','Proteger integridad de info, sistemas y redes de amenazas/riesgos/ataques'],
        ['D','Proteger info digital, sistemas y redes de amenazas/riesgos/ataques'],
      ], correct: ['A','B','D'] },
      { id: 'P2-50', parcial: 'p2', text: 'Técnica de esteganografía que modifica bits menos significativos', options: [
        ['A','Espacios en blanco en texto'],['B','LSB'],['C','ASCII'],['D','Cifrado simétrico + estego']
      ], correct: ['B'] },
    ];

    // ===============================
    // Lógica del quiz
    // ===============================
    const Setup = {
      bank: document.getElementById('bank'),
      count: document.getElementById('count'),
      shuffle: document.getElementById('shuffle'),
      instant: document.getElementById('instant'),
      start: document.getElementById('btnStart'),
      showAll: document.getElementById('btnShowAll'),
    };

    const Quiz = {
      wrap: document.getElementById('quiz'),
      setup: document.getElementById('setup'),
      study: document.getElementById('study'),
      studyList: document.getElementById('studyList'),
      progress: document.getElementById('progress'),
      meta: document.getElementById('meta'),
      qtext: document.getElementById('qtext'),
      multiHint: document.getElementById('multiHint'),
      choices: document.getElementById('choices'),
      counter: document.getElementById('counter'),
      navGrid: document.getElementById('navGrid'),
      btnPrev: document.getElementById('btnPrev'),
      btnNext: document.getElementById('btnNext'),
      btnCheck: document.getElementById('btnCheck'),
      btnFlag: document.getElementById('btnFlag'),
      results: document.getElementById('results'),
      score: document.getElementById('score'),
      btnRestart: document.getElementById('btnRestart'),
      btnReset: document.getElementById('btnReset'),
    };

    let state = {
      items: [],     // preguntas en juego
      i: 0,          // índice actual
      answers: {},   // id -> Set de letras seleccionadas
      checked: {},   // id -> boolean (comprobado)
      flags: new Set(),
      instant: false,
    };

    function selectBank() {
      const mode = Setup.bank.value; // ambos | p1 | p2
      let pool = RAW;
      if (mode === 'p1') pool = RAW.filter(q => q.parcial === 'p1');
      if (mode === 'p2') pool = RAW.filter(q => q.parcial === 'p2');
      return pool;
    }

    function startQuiz() {
      const pool = selectBank();
      let list = [...pool];
      if (Setup.shuffle.checked) shuffle(list);
      const wanted = Setup.count.value === 'all' ? list.length : Math.min(parseInt(Setup.count.value,10), list.length);
      state.items = list.slice(0, wanted);
      state.i = 0;
      state.answers = {};
      state.checked = {};
      state.flags = new Set();
      state.instant = Setup.instant.checked;

      Quiz.setup.classList.add('hidden');
      Quiz.wrap.classList.remove('hidden');
      Quiz.results.classList.add('hidden');
      document.getElementById('btnReset').classList.remove('hidden');

      renderQuestion();
      renderGrid();
    }

    function renderQuestion() {
      const q = state.items[state.i];
      const multi = q.correct.length > 1 || (q.subtitle||'').toLowerCase().includes('todas');
      Quiz.qtext.textContent = q.text + (q.subtitle ? ' ' + q.subtitle : '');
      Quiz.multiHint.classList.toggle('hidden', !multi);

      Quiz.progress.textContent = `Pregunta ${state.i+1} / ${state.items.length}`;
      Quiz.meta.textContent = `${q.id} • ${q.parcial.toUpperCase()}`;

      const selected = state.answers[q.id] ? new Set(state.answers[q.id]) : new Set();
      Quiz.choices.innerHTML = '';
      const opts = [...q.options];
      if (Setup.shuffle.checked) shuffle(opts);

      opts.forEach(([letter, text]) => {
        const isOn = selected.has(letter);
        const btn = document.createElement('button');
        btn.className = `choice w-full text-left px-3 py-3 rounded-xl border ${isOn? 'border-sky-500 bg-sky-500/10' : 'border-slate-700 bg-slate-800/70'} hover:border-sky-500 transition`;
        btn.innerHTML = `<div class="flex items-start gap-3"><div class="mt-1 shrink-0 w-6 h-6 rounded-lg border ${isOn? 'border-sky-400 bg-sky-500/30' : 'border-slate-600 bg-slate-700/50'}"></div><div><div class="font-semibold">${letter})</div><div class="opacity-90">${text}</div></div></div>`;
        btn.addEventListener('click', () => {
          toggleSelect(q.id, letter, multi);
          if (state.instant) checkCurrent(false);
          renderQuestion();
          highlightSelection(q);
        });
        Quiz.choices.appendChild(btn);
      });

      updateCounter();
    }

    function toggleSelect(qid, letter, multi) {
      const sel = state.answers[qid] ? new Set(state.answers[qid]) : new Set();
      if (!multi) sel.clear();
      if (sel.has(letter)) sel.delete(letter); else sel.add(letter);
      state.answers[qid] = [...sel];
    }

    function highlightSelection(q){
      if (!state.checked[q.id]) return;
      const correct = new Set(q.correct);
      [...Quiz.choices.children].forEach((el, idx) => {
        const letter = getLetterFromRendered(el);
        const userSel = new Set(state.answers[q.id]||[]);
        el.classList.remove('shake');
        if (correct.has(letter)) el.classList.add('border-emerald-500','bg-emerald-500/10');
        if (userSel.has(letter) && !correct.has(letter)) {
          el.classList.add('border-rose-500','bg-rose-500/10','shake');
        }
      });
    }

    function getLetterFromRendered(el){
      // La letra está en el primer div con font-semibold dentro
      return el.querySelector('.font-semibold')?.textContent?.replace(')','');
    }

    function checkCurrent(showToast=true){
      const q = state.items[state.i];
      const user = new Set(state.answers[q.id]||[]);
      const need = new Set(q.correct);
      const ok = user.size === need.size && [...user].every(x => need.has(x));
      state.checked[q.id] = true;
      highlightSelection(q);
      if (showToast) toast(ok ? '¡Correcto!' : 'Revisa tu respuesta');
      renderGrid();
      return ok;
    }

    function renderGrid(){
      Quiz.navGrid.innerHTML = '';
      state.items.forEach((q, idx) => {
        const user = new Set(state.answers[q.id]||[]);
        const need = new Set(q.correct);
        const checked = !!state.checked[q.id];
        const ok = checked && user.size === need.size && [...user].every(x=>need.has(x));
        const flagged = state.flags.has(q.id);
        const b = document.createElement('button');
        b.className = `text-xs rounded-lg px-2 py-1 border ${idx===state.i? 'border-sky-400 bg-sky-500/20' : 'border-slate-700 bg-slate-800/60'} ${ok? 'outline outline-1 outline-emerald-500' : ''}`;
        b.textContent = idx+1;
        if (flagged) b.title = 'Marcada';
        b.addEventListener('click', ()=>{ state.i = idx; renderQuestion(); highlightSelection(state.items[state.i]); });
        Quiz.navGrid.appendChild(b);
      });
    }

    function next(){
      if (state.i < state.items.length-1) { state.i++; renderQuestion(); highlightSelection(state.items[state.i]); }
    }
    function prev(){
      if (state.i > 0) { state.i--; renderQuestion(); highlightSelection(state.items[state.i]); }
    }

    function updateCounter(){
      const answered = Object.keys(state.answers).length;
      const marked = state.flags.size;
      Quiz.counter.textContent = `${answered}/${state.items.length} respondidas • ${marked} marcadas`;
    }

    function finish(){
      // Marca todas como comprobadas
      state.items.forEach(q=>{ if(!state.checked[q.id]) state.checked[q.id]=true; });
      const totals = score();
      Quiz.results.classList.remove('hidden');
      Quiz.score.textContent = `Puntaje: ${totals.ok} correctas de ${state.items.length} ( ${(totals.ok/state.items.length*100).toFixed(1)}% )`;
      renderGrid();
    }

    function review(){
      // muestra una revisión con colores marcados (ya la hace highlightSelection al navegar)
      toast('Modo revisión activado: usa la cuadrícula para navegar');
    }

    function score(){
      let ok = 0;
      state.items.forEach(q=>{
        const u = new Set(state.answers[q.id]||[]);
        const need = new Set(q.correct);
        const yes = u.size===need.size && [...u].every(x=>need.has(x));
        if (yes) ok++;
      });
      return { ok };
    }

    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.className = 'fixed bottom-4 left-1/2 -translate-x-1/2 bg-slate-800/90 border border-slate-700 px-4 py-2 rounded-xl text-sm shadow-xl';
      document.body.appendChild(t);
      setTimeout(()=>{ t.remove(); }, 1500);
    }

    function closeStudy(){
      Quiz.study.classList.add('hidden');
      Quiz.studyList.innerHTML = '';
    }

    function openStudy(){
      // Genera la lista con el filtro actual
      const pool = selectBank();
      const list = [...pool];
      if (Setup.shuffle.checked) shuffle(list);
      const container = Quiz.studyList;
      container.innerHTML = '';
      list.forEach(q=>{
        const block = document.createElement('div');
        const multi = q.correct.length>1 || (q.subtitle||'').toLowerCase().includes('todas');
        block.innerHTML = `
          <div class="rounded-xl border border-slate-700 bg-slate-800/60">
            <div class="p-4">
              <div class="text-xs opacity-70 mb-1">${q.id} • ${q.parcial.toUpperCase()} ${multi? '• múltiple' : ''}</div>
              <div class="font-semibold mb-3">${q.text} ${q.subtitle? `<span class='text-sky-300'>${q.subtitle}</span>`:''}</div>
              <ul class="space-y-2">
                ${q.options.map(([L, T])=>`<li class="rounded-lg border border-slate-700/80 px-3 py-2">${L}) ${T}</li>`).join('')}
              </ul>
              <div class="mt-3 text-sm"><span class="opacity-70">Respuesta correcta:</span> <span class="font-mono">${q.correct.join(', ')}</span></div>
            </div>
          </div>`;
        container.appendChild(block);
      });
      Quiz.study.classList.remove('hidden');
    }

    // Utils
    function shuffle(arr){
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // Event listeners
    Setup.start.addEventListener('click', startQuiz);
    Setup.showAll.addEventListener('click', openStudy);
    Quiz.btnPrev.addEventListener('click', prev);
    Quiz.btnNext.addEventListener('click', () => {
      if (!state.instant) {
        // Si no corregimos al vuelo, intentamos comprobar antes de pasar
        const ok = checkCurrent(false);
        // feedback suave
        toast(ok? '✔️ Correcto' : '❗ Aún no es correcto');
      }
      next();
    });
    Quiz.btnCheck.addEventListener('click', ()=>{ checkCurrent(true); });
    Quiz.btnFlag.addEventListener('click', ()=>{
      const q = state.items[state.i];
      if (state.flags.has(q.id)) state.flags.delete(q.id); else state.flags.add(q.id);
      updateCounter(); renderGrid();
    });
    Quiz.btnRestart.addEventListener('click', ()=>{
      Quiz.wrap.classList.add('hidden');
      Quiz.setup.classList.remove('hidden');
      Quiz.results.classList.add('hidden');
      document.getElementById('btnReset').classList.add('hidden');
      window.scrollTo({top:0,behavior:'smooth'});
    });
    document.getElementById('btnReset').addEventListener('click', ()=>{
      Quiz.wrap.classList.add('hidden');
      Quiz.setup.classList.remove('hidden');
      Quiz.results.classList.add('hidden');
      document.getElementById('btnReset').classList.add('hidden');
    });

    // Atajos de teclado
    window.addEventListener('keydown', (e)=>{
      if (Quiz.wrap.classList.contains('hidden')) return;
      if (e.key==='ArrowRight') next();
      if (e.key==='ArrowLeft') prev();
      if (e.key==='Enter') checkCurrent();
    });

    // Botón de finalizar aparece cuando llegas al final (reutilizamos btnNext)
    const obs = new MutationObserver(()=>{
      const last = state.i === state.items.length-1;
      Quiz.btnNext.textContent = last ? 'Finalizar' : 'Siguiente';
      Quiz.btnNext.onclick = last ? finish : ()=>{
        if (!state.instant) { const ok = checkCurrent(false); toast(ok? '✔️ Correcto' : '❗ Aún no es correcto'); }
        next();
      };
    });
    obs.observe(document.getElementById('progress'), { childList: true });
  </script>
</body>
</html>